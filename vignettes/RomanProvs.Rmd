---
#title: |
#    | Plotting ancient Roman provinces, 
#    | dates and regions with "sdam"
title: Plotting ancient Roman provinces and regions with 'sdam'
shorttitle: "Ancient Roman provinces"
#subtitle: <h1>dates and regions with "sdam"</h1>
#date: "`r format(Sys.time(), '%d %B %Y')`"
date: "22 February 2021" 
author: 
  - name: "Antonio Rivero Ostoic"
    affiliation: <center>CEDHAR, Aarhus University</center>
    email: <center>jaro@cas.au.dk</center>
output:
  html_document:
    theme: united
    highlight: tango
    code_folding: none
    keep_md: true
  pdf_document: default
---

<style type="text/css">
h1, h4 {
  text-align: center;
  color: DarkRed;
}
h1.title {
  font-size: 24pt;
}
h2 {
  font-size: 22pt;
}
h3 {
  font-size: 18pt;
}
</style>


```{r setup, echo=FALSE, message=FALSE}
knitr::opts_chunk$set(echo=TRUE,error=TRUE)
library("sdam")
#source("C:/R/AUArts/sdam-rev/bld/plot.map1.r")
#load(file="C:/R/AUArts/data-epi/edhatt.rda")
#load(file="C:/R/AUArts/data-epi/edh_ppd.rda")
```

```{r set-options, echo=FALSE, cache=FALSE}
options(width = 100)
```


<div style="margin-bottom:60px;"> </div>


### Preliminaries
`"sdam"` is an `R` package that provides tools for performing analyses within Social Dynamics and complexity in the
Ancient Mediterranean [SDAM](https://sdam-au.github.io/sdam-au/), which is a research group based at Aarhus University. 
It allows accessing and manipulating data from the Epigraphic Database Heidelberg API, performing HTTP requests, 
visualizing interval time events, compute probabilities of existence of archaeological assemblages and artifacts, and 
produce similarity matrices by simple matching between these objects. 

After uninstalling an old version of the `"sdam"` package from local machine and running as administrator, 
install version 0.4.0 from a GitHub repository. 

```{r sdam, echo=TRUE, eval=FALSE}
# remove old version from AU computer
remove.packages("sdam", lib="C:/Users/AUID/R/win-library/version/")
# install RC version from Github
require("devtools")
devtools::install_github("sdam-au/sdam")
```

```{r sdam0, echo=FALSE, eval=FALSE}
# install beta version
devtools::install_github("mplex/cedhar", subdir="pkg/sdam")
```


<div style="margin-bottom:30px;"> </div>

Load `"sdam"` and check version

```{r}
library("sdam")
packageVersion("sdam")
```



<div style="margin-bottom:60px;"> </div>


## Roman provinces
Package `"sdam"` comes with some datasets related to the Epigraphic Database Heidelberg, and also 
information about ancient Roman provinces and regions.


```{r, datasets, echo=TRUE, eval=FALSE}
data(package="sdam")
```


```
Datasets in package ‘sdam’:

EDH                                                 Epigraphic Database Heidelberg Dataset
rp                                                  Roman province names and acronyms as in EDH
rpmp                                                Maps of ancient Roman provinces and Italian regions
rpmcd                                               Caption maps and affiliation dates of Roman provinces
```



<div style="margin-bottom:30px;"> </div>

For instance, the acronym names of Roman provinces found in the `EDH` dataset 
can be obtained from `"rp"` as following:


```{r}
# Roman province acronyms according to EDH
data("rp")
names(unlist(rp))
```
<div style="margin-bottom:40px;"> </div>


Such output can result useful for other computations within `"sdam"` like accessing parts of `EDH` 
corresponding to the province with function `edhw()`. 


<div style="margin-bottom:60px;"> </div>


## Cartographical maps

Cartographical maps of Roman provinces under emperors Trajan and Hadrian (year 117AD), and Italian regions 
under emperor Augustus (year 27 BC) can be plotted with function `plot.map()`. This is a convenient function that 
depends on  `"rpmp"`, which ia a dataset that  contains the names and vector shapes of the maps and, if wanted, 
it also invokes dataset `"rpmcd"` for including map captions in the plot plus date(s) when such territory ``officially'' 
became a Roman province.


<div style="margin-bottom:30px;"> </div>


As an example, we start with the first province in `"rp"` that corresponds to `"Ach"` or `"Achaia"`:

```{r, mapprov, echo=TRUE, eval=TRUE}
# plot cartographical map of Achaia
plot.map(x=names(rp)[1])
```



<div style="margin-bottom:120px;"> </div>

### Italian regions

Similarly, a plot of the cartographical map for the last entry in `"rp"` that is 
the Italian region `"VeH"` or `"Venetia et Histria (Regio X)"` is obtained as:


```{r, mapreg, echo=TRUE, eval=TRUE}
# plot cartographical map of Venetia et Histria (Regio X)
plot.map(x=tail(names(rp),1))
```


<div style="margin-bottom:60px;"> </div>



Not all entries in `"rp"` are currently supported in `plot.map()`, only the territories 
belonging to the Roman Empire in year 117AD. However, there is also a silhouette of Italy, 
which is depicted using the plotting function without a caption by setting the `cap` argument 
into `FALSE`:



```{r, mapita, echo=TRUE, eval=TRUE}
# plot silhouette of Italy
plot.map(x="Ita", cap=FALSE)
```



<div style="margin-bottom:60px;"> </div>


## Dating provinces

Dataset `"rpmcd"` contains the approx. year when the province became part of the Roman Empire and, 
in the case of regions, a year of consolidation for the Italian peninsula. 

As with `"rpmp"` dataset, `"rpmcd"` is another datase with a list of lists where information about map 
shapes is recorded. Additionally, the years are located in the `provd` component for each entry 
corresponding to the supported province or region. 


```{r, provd, echo=TRUE, eval=TRUE}
# 'provd' component of each entry is a date
data("rpmcd")
rpmcd[[1]]$provd
```

<div style="margin-bottom:30px;"> </div>

Since all years are located in the second component, we obtain the affiliation dates from these components 
for all provinces/regions and recorded this information in object `est` (that stand for established). 

```{r, est, echo=-3, eval=TRUE}
# dates in an atomic vector
est <- unlist(lapply(rpmcd, function (x) x[[2]]), use.names=FALSE)
est
```

<div style="margin-bottom:30px;"> </div>

Then we use a regular expression to remove the text `"(Ita c)"` from the last 11 entries in `est` that 
correspond to the Italian regions. In this way, we count only date information in this object for further 
computation:


```{r, est2, echo=-2, eval=TRUE}
est[(length(est)-10):length(est)] <- sub(" [(].*","",tail(est,11))
est
```

<!-- ```{r estout, size="tiny", echo=TRUE, eval=FALSE}
# [1] "27 BC"          "30 BC"          "146 BC"         "63AD or 58AD"   "63AD or 14BC"   "63AD or 14BC"   "51 BC"          "105 AD"         "114 AD"         "133 BC"        
#[11] "116 AD"         "197 BC"         "51 BC"          "74BC or 64BC"   "43 AD"          "17 AD"          "64 BC"          "238 BC"         "66 BC?"         "58 or 30 BC"   
#[21] "74 BC"          "106 AD"         "32BC or 10AD"   "148 BC"         "25 BC"          "27 BC"          "27 BC"          "197 BC"         "272 BC"         "6 AD"          
#[31] "51 BC"          "197 BC"         "43 AD"          "42AD or 44AD"   "148 BC?"        "42 AD or 44 AD" "116 AD"         "6 AD"           "6 AD"           "121 BC"        
#[41] "16BC or 15BC"   "9AD or 10AD"    "9AD or 10AD"    "16BC or 15BC"   "238 BC"         "241 BC"         "64 BC"          "46 AD"          "272 BC"         "272 BC"        
#[51] "272 BC"         "272 BC"         "272 BC"         "272 BC"         "272 BC"         "272 BC"         "272 BC"         "272 BC"         "272 BC"
``` -->


<div style="margin-bottom:60px;"> </div>



### Treating dates

`"sdam"` has the internal function `dts()` to convert dates having characters into a numerical format, which may 
be useful in further computations like when working with chronologies. 

```{r, dts, echo=TRUE, eval=FALSE}
# dates internal function
dts(est)
```


<!-- ```{r dtsout, size="tiny", echo=TRUE, eval=FALSE}
#         27 BC          30 BC         146 BC   63AD or 58AD   63AD or 14BC   63AD or 14BC          51 BC         105 AD         114 AD         133 BC         116 AD 
#           -27            -30           -146             63             63             63            -51            105            114           -133            116 
#        197 BC          51 BC   74BC or 64BC          43 AD          17 AD          64 BC         238 BC         66 BC?    58 or 30 BC          74 BC         106 AD 
#          -197            -51            -74             43             17            -64           -238            -66            -58            -74            106 
#  32BC or 10AD         148 BC          25 BC          27 BC          27 BC         197 BC         272 BC           6 AD          51 BC         197 BC          43 AD 
#           -32           -148            -25            -27            -27           -197           -272              6            -51           -197             43 
#  42AD or 44AD        148 BC? 42 AD or 44 AD         116 AD           6 AD           6 AD         121 BC   16BC or 15BC    9AD or 10AD    9AD or 10AD   16BC or 15BC 
#            42           -148             42            116              6              6           -121            -16              9              9            -16 
#        238 BC         241 BC          64 BC          46 AD         272 BC         272 BC         272 BC         272 BC         272 BC         272 BC         272 BC 
#          -238           -241            -64             46           -272           -272           -272           -272           -272           -272           -272 
#        272 BC         272 BC         272 BC         272 BC 
#          -272           -272           -272           -272
``` -->


<div style="margin-bottom:30px;"> </div>


In the following example, we omit the 11 Italian regions in object `chron` that records the dates in ascending order 
when the territory became officially part of the Roman Empire. 
In case an item has two competing dates, which is here related with the word `or`, then `dts()` takes only the first date. 



```{r, chron, echo=-2, eval=TRUE}
chron <- sort(dts(est[seq_len(length(est)-11)]))
chron
```

<!-- ```{r chronout, size="tiny", echo=TRUE, eval=FALSE}
#        272 BC         241 BC         238 BC         238 BC         197 BC         197 BC         197 BC         148 BC        148 BC?         146 BC         133 BC 
#          -272           -241           -238           -238           -197           -197           -197           -148           -148           -146           -133 
#        121 BC   74BC or 64BC          74 BC         66 BC?          64 BC          64 BC    58 or 30 BC          51 BC          51 BC          51 BC   32BC or 10AD 
#          -121            -74            -74            -66            -64            -64            -58            -51            -51            -51            -32 
#         30 BC          27 BC          27 BC          27 BC          25 BC   16BC or 15BC   16BC or 15BC           6 AD           6 AD           6 AD    9AD or 10AD 
#           -30            -27            -27            -27            -25            -16            -16              6              6              6              9 
#   9AD or 10AD          17 AD   42AD or 44AD 42 AD or 44 AD          43 AD          43 AD          46 AD   63AD or 58AD   63AD or 14BC   63AD or 14BC         105 AD 
#             9             17             42             42             43             43             46             63             63             63            105 
#        106 AD         114 AD         116 AD         116 AD 
#           106            114            116            116
``` -->

<div style="margin-bottom:60px;"> </div>

The code below produces cartographical maps of Roman provinces and regions according to their incorporation to the Roman Empire


```{r, pchron, echo=TRUE, eval=FALSE}
for(i in seq_len(length(unique(names(chron))))) 
	try(plot.map(x=sub(".", "",names(rpmcd)[which(est%in%unique(names(chron))[i])]), date=TRUE))
```


<div style="margin-bottom:60px;"> </div>



### Note
Note that the positioning of the dates with `plot.map()` is for a `pdf` output and it may change with another format. 
Since this function depends on the `"grid"` package and not `"graphics"` you may need `"gridExtra"` for multiple plots rather 
that `par(mfrow=x,x)`. 


<div style="margin-bottom:60px;"> </div>



### See also

* [Social Dynamics and complexity in the Ancient Mediterranean Poject](https://sdam-au.github.io/sdam-au/)
<!-- * [R package `"sdam"`](https://sdam-au.github.io/sdam/) -->
* [`"sdam"` manual](https://github.com/mplex/cedhar/blob/master/typesetting/reports/sdam.pdf)



<div style="margin-bottom:60px;"> </div>





